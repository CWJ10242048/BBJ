import{k as W,r as f,$ as X,E as p,b as i,o as q,c as E,d as l,f as s,w as a,q as Y,g as _,t as U,h as g,i as ee,y as le,ap as F,aq as M,ar as se,l as ae}from"./index-8f7409db.js";import{a as te}from"./axios-3a665b0f.js";import{l as I}from"./lock-back-25e5fa6a.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";const T=te.create({baseURL:{}.VITE_API_BASE_URL,timeout:5e3,headers:{"Content-Type":"application/json"}});T.interceptors.request.use(d=>{const u=localStorage.getItem("token");return u&&(d.headers.Authorization=`Bearer ${u}`),d},d=>Promise.reject(d));T.interceptors.response.use(d=>d,d=>(d.response&&d.response.status===401&&(localStorage.removeItem("token"),window.location.href="/login"),Promise.reject(d)));const L={id:1,username:"teacher",nickname:"李老师",avatarUrl:I,phone:"13800000000",email:"Mrsli@example.com",school:"计算机科学大学",subject:"computer_science",role:"teacher"},D=(d,u=500)=>new Promise(k=>{setTimeout(()=>{k({data:d})},u)}),re={class:"profile-container"},ne={class:"profile-content"},ie={class:"profile-card-header"},de={class:"profile-avatar-section"},ue={class:"avatar-container"},ce=["src"],me={class:"avatar-hover-mask"},pe={class:"user-name"},ve={class:"user-role"},fe={class:"user-info-summary"},_e={class:"info-item"},ge={class:"info-item"},we={class:"info-item"},be={class:"profile-edit-section"},ye={class:"form-actions"},Ve={class:"security-section"},he={class:"security-item"},Ue={class:"security-item-info"},ke={class:"security-item-title"},Pe={class:"security-item"},xe={class:"security-item-info"},Re={class:"security-item-title"},je={class:"security-item-desc"},Ae={class:"security-item"},Ce={class:"security-item-info"},qe={class:"security-item-title"},De={class:"security-item-desc"},Ie={class:"notification-settings"},Se={class:"setting-item"},Be={class:"setting-item"},Ee={class:"setting-item"},Fe={class:"setting-item"},Me={class:"dialog-footer"},A=!0,Le=W({__name:"Profile",setup(d){const u=f(),k=f(),P=f(!1),w=f(!1),R=f(!1),t=f({id:0,username:"",nickname:"李老师",avatarUrl:"",phone:"13800000000",email:"Mrsli@example.com",school:"计算机科学大学",subject:"computer_science",role:"teacher"}),v=f({system:!0,resources:!0,collaboration:!0,email:!1}),$={nickname:[{required:!0,message:"请输入昵称",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"手机号格式不正确",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:(r,e,n)=>{/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)?n():n(new Error("邮箱格式不正确"))},trigger:"blur"}],school:[{required:!0,message:"请输入学校",trigger:"blur"}],subject:[{required:!0,message:"请选择教学科目",trigger:"change"}]},c=f({oldPwd:"",newPwd:"",confirmPwd:""}),z={oldPwd:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPwd:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码至少6位",trigger:"blur"}],confirmPwd:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(r,e,n)=>{e!==c.value.newPwd?n(new Error("两次输入密码不一致")):n()},trigger:"blur"}]};X(async()=>{try{await S()}catch(r){console.error("获取用户信息失败:",r)}});const S=async()=>{try{w.value=!0;let r;A&&(r=(await D(L)).data),t.value={...r,avatarUrl:r.avatarUrl||I},w.value=!1}catch(r){w.value=!1,console.error("获取用户信息失败:",r),p.error("获取用户信息失败，将使用默认数据"),t.value={id:0,username:"teacher",nickname:"李老师",avatarUrl:I,phone:"13800000000",email:"Mrsli@example.com",school:"计算机科学大学",subject:"computer_science",role:"teacher"},p.success("已加载默认数据")}},N=async r=>{try{let e;if(A){const n=new FileReader;n.onload=h=>{var b;t.value.avatarUrl=(b=h.target)==null?void 0:b.result,p.success("头像上传成功")},n.readAsDataURL(r.raw);return}}catch(e){console.error("头像上传失败:",e),p.error("头像上传失败");const n=new FileReader;n.onload=h=>{var b;t.value.avatarUrl=(b=h.target)==null?void 0:b.result},n.readAsDataURL(r.raw)}},Z=async()=>{if(u.value)try{await u.value.validate(),w.value=!0;const r={nickname:t.value.nickname,phone:t.value.phone,email:t.value.email,school:t.value.school,subject:t.value.subject};A&&(await D({...L,...r}),t.value={...t.value,...r}),p.success("保存成功"),w.value=!1}catch(r){w.value=!1,console.error("保存失败:",r),p.error("保存失败，请检查输入信息")}},G=()=>{u.value&&(u.value.resetFields(),S())},H=async()=>{if(k.value)try{await k.value.validate(),R.value=!0,A&&await D({success:!0,message:"密码修改成功"}),P.value=!1,c.value={oldPwd:"",newPwd:"",confirmPwd:""},p.success("密码修改成功"),R.value=!1}catch(r){R.value=!1,console.error("密码修改失败:",r),r.response&&r.response.data&&r.response.data.message?p.error(r.response.data.message):p.error("密码修改失败，请检查原密码是否正确")}};return(r,e)=>{const n=i("el-icon"),h=i("el-upload"),b=i("el-tag"),J=i("el-card"),y=i("el-input"),m=i("el-form-item"),x=i("el-option"),K=i("el-select"),V=i("el-button"),B=i("el-form"),C=i("el-tab-pane"),j=i("el-switch"),O=i("el-tabs"),Q=i("el-dialog");return q(),E("div",re,[e[33]||(e[33]=l("div",{class:"profile-header"},[l("h1",{class:"profile-title"},"个人中心"),l("div",{class:"profile-subtitle"},"管理您的个人信息和账户设置")],-1)),l("div",ne,[s(J,{class:"profile-card","body-style":{padding:"0"}},{default:a(()=>[l("div",ie,[l("div",de,[s(h,{class:"avatar-uploader","show-file-list":!1,"auto-upload":!1,accept:".png,.jpg,.jpeg",onChange:N},{default:a(()=>[l("div",ue,[t.value.avatarUrl?(q(),E("img",{key:0,src:t.value.avatarUrl,class:"avatar"},null,8,ce)):(q(),Y(n,{key:1,class:"avatar-placeholder"},{default:a(()=>[s(_(ee))]),_:1})),l("div",me,[s(n,null,{default:a(()=>[s(_(le))]),_:1}),e[15]||(e[15]=l("span",null,"更换头像",-1))])])]),_:1}),l("div",pe,U(t.value.nickname),1),l("div",ve,[s(b,{size:"small",effect:"plain",type:"success"},{default:a(()=>e[16]||(e[16]=[g("教师账号")])),_:1})])])]),e[17]||(e[17]=l("div",{class:"profile-stats"},[l("div",{class:"stat-item"},[l("div",{class:"stat-value"},"28"),l("div",{class:"stat-label"},"教案")]),l("div",{class:"stat-item"},[l("div",{class:"stat-value"},"15"),l("div",{class:"stat-label"},"PPT")]),l("div",{class:"stat-item"},[l("div",{class:"stat-value"},"32"),l("div",{class:"stat-label"},"习题")])],-1)),l("div",fe,[l("div",_e,[s(n,null,{default:a(()=>[s(_(F))]),_:1}),l("span",null,U(t.value.email),1)]),l("div",ge,[s(n,null,{default:a(()=>[s(_(M))]),_:1}),l("span",null,U(t.value.phone),1)]),l("div",we,[s(n,null,{default:a(()=>[s(_(se))]),_:1}),l("span",null,U(t.value.school),1)])])]),_:1}),l("div",be,[s(O,{type:"border-card",class:"custom-tabs"},{default:a(()=>[s(C,{label:"基本资料"},{default:a(()=>[s(B,{model:t.value,rules:$,ref_key:"formRef",ref:u,"label-width":"100px",class:"user-form"},{default:a(()=>[s(m,{label:"昵称",prop:"nickname"},{default:a(()=>[s(y,{modelValue:t.value.nickname,"onUpdate:modelValue":e[0]||(e[0]=o=>t.value.nickname=o),placeholder:"请输入昵称","prefix-icon":"User"},null,8,["modelValue"])]),_:1}),s(m,{label:"手机号",prop:"phone"},{default:a(()=>[s(y,{modelValue:t.value.phone,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.phone=o),placeholder:"请输入手机号",maxlength:"11","prefix-icon":"Phone"},null,8,["modelValue"])]),_:1}),s(m,{label:"邮箱",prop:"email"},{default:a(()=>[s(y,{modelValue:t.value.email,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.email=o),placeholder:"请输入邮箱","prefix-icon":"Message"},null,8,["modelValue"])]),_:1}),s(m,{label:"所在学校",prop:"school"},{default:a(()=>[s(y,{modelValue:t.value.school,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.school=o),placeholder:"请输入学校名称","prefix-icon":"School"},null,8,["modelValue"])]),_:1}),s(m,{label:"教学科目",prop:"subject"},{default:a(()=>[s(K,{modelValue:t.value.subject,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.subject=o),placeholder:"请选择教学科目",style:{width:"100%"}},{default:a(()=>[s(x,{label:"计算机科学",value:"computer_science"}),s(x,{label:"编程",value:"programming"}),s(x,{label:"数据库",value:"database"}),s(x,{label:"人工智能",value:"ai"}),s(x,{label:"网络安全",value:"security"})]),_:1},8,["modelValue"])]),_:1}),s(m,null,{default:a(()=>[l("div",ye,[s(V,{type:"primary",onClick:Z,loading:w.value},{default:a(()=>e[18]||(e[18]=[g("保存信息")])),_:1},8,["loading"]),s(V,{onClick:G},{default:a(()=>e[19]||(e[19]=[g("重置")])),_:1})])]),_:1})]),_:1},8,["model"])]),_:1}),s(C,{label:"账户安全"},{default:a(()=>[l("div",Ve,[l("div",he,[l("div",Ue,[l("div",ke,[s(n,null,{default:a(()=>[s(_(ae))]),_:1}),e[20]||(e[20]=l("span",null,"账户密码",-1))]),e[21]||(e[21]=l("div",{class:"security-item-desc"},"定期修改密码可以保护账户安全",-1))]),s(V,{type:"primary",onClick:e[5]||(e[5]=o=>P.value=!0)},{default:a(()=>e[22]||(e[22]=[g("修改密码")])),_:1})]),l("div",Pe,[l("div",xe,[l("div",Re,[s(n,null,{default:a(()=>[s(_(M))]),_:1}),e[23]||(e[23]=l("span",null,"手机验证",-1))]),l("div",je,"已绑定手机: "+U(t.value.phone),1)]),s(V,{type:"primary",plain:""},{default:a(()=>e[24]||(e[24]=[g("更换手机")])),_:1})]),l("div",Ae,[l("div",Ce,[l("div",qe,[s(n,null,{default:a(()=>[s(_(F))]),_:1}),e[25]||(e[25]=l("span",null,"邮箱验证",-1))]),l("div",De,"已绑定邮箱: "+U(t.value.email),1)]),s(V,{type:"primary",plain:""},{default:a(()=>e[26]||(e[26]=[g("更换邮箱")])),_:1})])])]),_:1}),s(C,{label:"消息通知"},{default:a(()=>[l("div",Ie,[l("div",Se,[e[27]||(e[27]=l("div",{class:"setting-info"},[l("div",{class:"setting-title"},"系统通知"),l("div",{class:"setting-desc"},"接收系统更新、维护等通知")],-1)),s(j,{modelValue:v.value.system,"onUpdate:modelValue":e[6]||(e[6]=o=>v.value.system=o),"active-color":"#3d5afe"},null,8,["modelValue"])]),l("div",Be,[e[28]||(e[28]=l("div",{class:"setting-info"},[l("div",{class:"setting-title"},"资源更新提醒"),l("div",{class:"setting-desc"},"有新的教学资源时通知我")],-1)),s(j,{modelValue:v.value.resources,"onUpdate:modelValue":e[7]||(e[7]=o=>v.value.resources=o),"active-color":"#3d5afe"},null,8,["modelValue"])]),l("div",Ee,[e[29]||(e[29]=l("div",{class:"setting-info"},[l("div",{class:"setting-title"},"协作邀请"),l("div",{class:"setting-desc"},"接收新的协作邀请通知")],-1)),s(j,{modelValue:v.value.collaboration,"onUpdate:modelValue":e[8]||(e[8]=o=>v.value.collaboration=o),"active-color":"#3d5afe"},null,8,["modelValue"])]),l("div",Fe,[e[30]||(e[30]=l("div",{class:"setting-info"},[l("div",{class:"setting-title"},"邮件通知"),l("div",{class:"setting-desc"},"通过邮件接收重要通知")],-1)),s(j,{modelValue:v.value.email,"onUpdate:modelValue":e[9]||(e[9]=o=>v.value.email=o),"active-color":"#3d5afe"},null,8,["modelValue"])])])]),_:1})]),_:1})])]),s(Q,{modelValue:P.value,"onUpdate:modelValue":e[14]||(e[14]=o=>P.value=o),title:"修改密码",width:"400px","destroy-on-close":""},{footer:a(()=>[l("div",Me,[s(V,{onClick:e[13]||(e[13]=o=>P.value=!1)},{default:a(()=>e[31]||(e[31]=[g("取消")])),_:1}),s(V,{type:"primary",onClick:H,loading:R.value},{default:a(()=>e[32]||(e[32]=[g("确认修改")])),_:1},8,["loading"])])]),default:a(()=>[s(B,{model:c.value,rules:z,ref_key:"pwdFormRef",ref:k,"label-width":"100px"},{default:a(()=>[s(m,{label:"旧密码",prop:"oldPwd"},{default:a(()=>[s(y,{modelValue:c.value.oldPwd,"onUpdate:modelValue":e[10]||(e[10]=o=>c.value.oldPwd=o),type:"password",placeholder:"请输入旧密码","show-password":""},null,8,["modelValue"])]),_:1}),s(m,{label:"新密码",prop:"newPwd"},{default:a(()=>[s(y,{modelValue:c.value.newPwd,"onUpdate:modelValue":e[11]||(e[11]=o=>c.value.newPwd=o),type:"password",placeholder:"请输入新密码","show-password":""},null,8,["modelValue"])]),_:1}),s(m,{label:"确认新密码",prop:"confirmPwd"},{default:a(()=>[s(y,{modelValue:c.value.confirmPwd,"onUpdate:modelValue":e[12]||(e[12]=o=>c.value.confirmPwd=o),type:"password",placeholder:"请再次输入新密码","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const Ze=oe(Le,[["__scopeId","data-v-26fc8b15"]]);export{Ze as default};
