import{k as fe,r as f,b as c,o as i,c as p,d as r,f as l,w as t,g as k,h as d,F as z,e as A,q as x,t as m,s as $,ab as ve,E as y,N as ye,A as B,ah as _e,af as ge}from"./index-8f7409db.js";import{a as he}from"./axios-3a665b0f.js";import be from"./Graphic-04eab11f.js";import{_ as Te}from"./_plugin-vue_export-helper-c27b6911.js";const ke={class:"pptgen-container"},xe={class:"card-header"},Ve={class:"lesson-plan-selection"},we={key:0,class:"history-section"},Pe={class:"history-option"},Ce={class:"name-tag-group"},Fe={class:"option-time"},Ue={key:1,class:"upload-section"},$e={class:"card-header"},Ge={class:"header-title"},Ie={key:0,class:"ai-tag"},Re={class:"header-buttons"},Le={class:"chapters-container"},ze={class:"chapter-header"},Ae={class:"chapter-title"},Be={class:"chapter-duration-num"},Se={class:"chapter-content"},Ee={key:0,class:"graphic-preview"},Ne={key:1,class:"graphic-actions"},je={class:"card-header"},qe={class:"header-title"},Me={key:0,class:"ai-tag"},Oe={class:"button-group"},We={class:"preview-content"},He={key:0},De={key:1,class:"desc-pre"},Je={key:0},Ke={key:1,class:"desc-pre"},Qe={class:"chapters-preview"},Xe=["src"],Ye=fe({__name:"PPT",setup(Ze){const C=f(),S=f(!1),G=f(!1),n=f({title:"",usage:"",syllabusFile:[],syllabusText:"",referenceFile:[],referenceText:"",remark:""}),Q={title:[{required:!0,message:"请输入PPT主题",trigger:"blur"}],usage:[{required:!0,message:"请输入章节/用途",trigger:"blur"}],syllabus:[{validator:(o,e,s)=>{!n.value.syllabusFile.length&&!n.value.syllabusText?s(new Error("请上传教学大纲文件或输入文本")):s()},trigger:"blur"}]},E=f("history"),I=f(""),X=f(!1),O=f([{id:"1",name:"机器学习线性回归教案",type:"教案",time:"2025-05-10 15:32:10",content:{title:"机器学习线性回归",usage:"第4章",syllabus:"机器学习课程教学大纲",stages:[{name:"复习旧知",time:10,content:"回顾上节课的线性回归基本概念和最小二乘估计原理"},{name:"导入新课",time:15,content:"通过房价预测案例引入线性回归的应用场景"},{name:"讲解新知",time:45,content:"详细讲解梯度下降算法原理和实现"},{name:"案例分析",time:20,content:"通过实际数据集演示线性回归模型的训练过程"},{name:"总结提升",time:10,content:"总结本节课重点，布置课后作业"}],reference:"《机器学习实战》",remark:"重点讲解梯度下降算法"}}]),W=f([0]),h=f([]),V=f(!1),R=f(null),L=f(!1);f(!1);const N=f(!1),F=f(!1),Y=o=>({教案:"success",PPT:"warning",习题:"danger",教学大纲:"info",资源:"primary"})[o]||"",Z=o=>new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),ee=()=>{X.value=!0},le=o=>{const e=O.value.find(s=>s.id===o);e&&e.content?(n.value.title=`${e.content.title} (PPT)`,n.value.usage=e.content.usage,n.value.syllabusText=`根据教案 "${e.name}" 生成的教学大纲要点：
${e.content.syllabus||"(无具体文本，请参考源文件)"}`,n.value.referenceText=e.content.reference||"无",n.value.remark=`AI 生成备注：基于教案 "${e.name}" 的内容，${e.content.remark||"无特殊备注"}`,n.value.syllabusFile=[],n.value.referenceFile=[],F.value=!0,te(e.content.stages),L.value=!1,y.success("已根据所选教案自动填充PPT基本信息和章节")):D()},te=o=>{h.value=o.map(e=>({title:e.name,content:e.content,duration:e.time,graphic:null,graphicType:[],graphicRequirements:{type:"",style:"",subject:"",knowledge:"",custom:""}}))},ae=async()=>{if(!h.value||h.value.length===0){y.warning("请先选择或生成章节");return}N.value=!0;const o=e=>{const s=e.toLowerCase();return s.includes("复习")||s.includes("总结")?{resourceType:"image",types:["思维导图","概念图"]}:s.includes("导入")||s.includes("引入")?{resourceType:"video",types:["动画科普","快速剪辑"],duration:45}:s.includes("讲解新知")||s.includes("梯度下降")?{resourceType:"video",types:["教学演示","动画科普"],duration:90}:s.includes("讲解")||s.includes("讲授")?{resourceType:"image",types:["概念图","流程图"]}:s.includes("案例分析")?{resourceType:"image",types:["数据图表","示意图"]}:s.includes("练习")?{resourceType:"image",types:["示意图"]}:s.includes("互动")||s.includes("讨论")?{resourceType:"video",types:["教学演示(模拟)"],duration:60}:{resourceType:"image",types:["示意图"]}};try{for(const e of h.value){const s=o(e.title);let u="",v=[];s.resourceType==="video"?(u=`https://via.placeholder.com/150x100/000000/FFFFFF/?text=Video:${encodeURIComponent(e.title)}`,v=s.types.map(_=>`视频-${_}${s.duration?` (${s.duration}s)`:""}`)):(u=`https://via.placeholder.com/150x100.png?text=Image:${encodeURIComponent(e.title)}`,v=s.types.map(_=>`图片-${_}`)),e.graphic=u,e.graphicType=v,await new Promise(_=>setTimeout(_,150))}L.value=!0,y.success("所有章节资源已生成")}catch(e){console.error("批量生成资源失败:",e),y.error("批量生成资源失败")}finally{N.value=!1}},H=o=>{R.value={...o,isAIGenerated:!1,subject:n.value.title,planTitle:n.value.title},V.value=!0},se=o=>{var e,s;if(R.value){const u=h.value.find(v=>v.title===R.value.title);if(u){u.graphic=o.url;let v=[];o.resourceType==="image"?v=(((e=o.details)==null?void 0:e.imageTypes)||["示意图"]).map(_=>`图片-${_}`):o.resourceType==="video"&&(v=(((s=o.details)==null?void 0:s.videoStyle)||["教学演示"]).map(_=>{var w;return`视频-${_}${(w=o.details)!=null&&w.duration?` (${o.details.duration}s)`:""}`})),u.graphicType=v,V.value=!1,y.success("资源生成成功")}}},oe=(o,e)=>{const s=o.graphicType.indexOf(e);s>-1&&o.graphicType.splice(s,1),o.graphicType.length===0?(o.graphic=null,y.success("资源已删除")):y.success(`标签 "${e}" 已删除`)},j=(o,e)=>{o&&o.raw&&(e==="syllabus"?(n.value.syllabusFile=[o.raw],n.value.syllabusText="",F.value=!1):e==="reference"?(n.value.referenceFile=[o.raw],n.value.referenceText="",F.value=!1):y.success("教案文件 "+o.name+" 已选择，待处理..."))},ne=async()=>{if(C.value)try{await C.value.validate(),y.success("保存成功")}catch{y.error("请填写完整信息")}},re=()=>{S.value=!0},ue=async()=>{G.value=!0;try{await new Promise(v=>setTimeout(v,2e3));const o=await he.get("/api/export/ppt",{responseType:"blob"}),e=new Blob([o.data],{type:o.headers["content-type"]}),s=window.URL.createObjectURL(e),u=document.createElement("a");u.href=s,u.download="机器学习线性回归PPT.pptx",document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(s),y.success("导出成功")}catch{y.error("导出失败")}finally{G.value=!1}},D=()=>{C.value&&(C.value.resetFields(),n.value={title:"",usage:"",syllabusFile:[],syllabusText:"",referenceFile:[],referenceText:"",remark:""},I.value="",h.value=[],L.value=!1,F.value=!1)};return(o,e)=>{const s=c("el-icon"),u=c("el-button"),v=c("el-radio-button"),_=c("el-radio-group"),w=c("el-tag"),ie=c("el-option"),de=c("el-select"),q=c("el-upload"),M=c("el-card"),T=c("el-input"),b=c("el-form-item"),J=c("el-form"),ce=c("el-collapse-item"),pe=c("el-collapse"),U=c("el-descriptions-item"),me=c("el-descriptions"),K=c("el-dialog");return i(),p("div",ke,[e[31]||(e[31]=r("h2",null,"PPT生成",-1)),l(M,{class:"box-card"},{header:t(()=>[r("div",xe,[e[12]||(e[12]=r("span",null,"教案选择",-1)),l(u,{type:"primary",size:"small",onClick:ee},{default:t(()=>[l(s,null,{default:t(()=>[l(k(ye))]),_:1}),e[11]||(e[11]=d(" 浏览教案 "))]),_:1})])]),default:t(()=>[r("div",Ve,[l(_,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=a=>E.value=a),size:"small",class:"source-selector"},{default:t(()=>[l(v,{label:"history"},{default:t(()=>e[13]||(e[13]=[d("历史教案")])),_:1}),l(v,{label:"upload"},{default:t(()=>e[14]||(e[14]=[d("上传教案")])),_:1})]),_:1},8,["modelValue"]),E.value==="history"?(i(),p("div",we,[l(de,{modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=a=>I.value=a),placeholder:"选择历史教案",filterable:"",class:"wide-select",onChange:le},{default:t(()=>[(i(!0),p(z,null,A(O.value,a=>(i(),x(ie,{key:a.id,label:a.name,value:a.id},{default:t(()=>[r("div",Pe,[r("div",Ce,[r("span",null,m(a.name),1),l(w,{size:"small",type:Y(a.type),class:"type-tag"},{default:t(()=>[d(m(a.type),1)]),_:2},1032,["type"])]),r("span",Fe,m(Z(a.time)),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])):(i(),p("div",Ue,[l(q,{class:"upload-demo","auto-upload":!1,"show-file-list":!0,"on-change":j,accept:".pdf,.doc,.docx"},{tip:t(()=>e[16]||(e[16]=[r("div",{class:"el-upload__tip"},"支持PDF、Word等格式",-1)])),default:t(()=>[l(u,{type:"primary"},{default:t(()=>e[15]||(e[15]=[d("选择教案文件")])),_:1})]),_:1})]))])]),_:1}),I.value?(i(),x(M,{key:0,class:"box-card"},{header:t(()=>[r("div",$e,[r("div",Ge,[e[18]||(e[18]=r("span",null,"PPT章节编辑",-1)),L.value?(i(),p("span",Ie,e[17]||(e[17]=[r("span",{class:"ai-dot"},null,-1),d(" AI自动生成 ")]))):$("",!0)]),r("div",Re,[l(u,{type:"primary",size:"small",onClick:ae,loading:N.value},{default:t(()=>[l(s,null,{default:t(()=>[l(k(B))]),_:1}),e[19]||(e[19]=d(" 一键生成资源 "))]),_:1},8,["loading"])])])]),default:t(()=>[r("div",Le,[l(pe,{modelValue:W.value,"onUpdate:modelValue":e[2]||(e[2]=a=>W.value=a)},{default:t(()=>[(i(!0),p(z,null,A(h.value,(a,P)=>(i(),x(ce,{key:P,name:P},{title:t(()=>[r("div",ze,[r("span",Ae,"第"+m(P+1)+"章："+m(a.title),1),l(w,{class:"chapter-duration-tag",type:"info",effect:"light"},{default:t(()=>[l(s,{class:"chapter-duration-icon"},{default:t(()=>[l(k(_e))]),_:1}),r("span",Be,m(a.duration),1),e[20]||(e[20]=r("span",{class:"chapter-duration-unit"},"分钟",-1))]),_:2},1024)])]),extra:t(()=>[l(u,{type:"primary",link:"",onClick:ve(g=>H(a),["stop"])},{default:t(()=>[l(s,null,{default:t(()=>[l(k(B))]),_:1}),e[21]||(e[21]=d(" 生成资源 "))]),_:2},1032,["onClick"])]),default:t(()=>[r("div",Se,[l(J,{model:a,"label-width":"100px"},{default:t(()=>[l(b,{label:"章节标题"},{default:t(()=>[l(T,{modelValue:a.title,"onUpdate:modelValue":g=>a.title=g,placeholder:"请输入章节标题"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(b,{label:"章节内容"},{default:t(()=>[l(T,{modelValue:a.content,"onUpdate:modelValue":g=>a.content=g,type:"textarea",rows:4,placeholder:"请输入章节内容"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(b,{label:"资源"},{default:t(()=>[a.graphic&&a.graphicType.length>0?(i(),p("div",Ee,[(i(!0),p(z,null,A(a.graphicType,g=>(i(),x(w,{key:g,type:g.startsWith("视频")?"warning":"success",effect:"light",style:{"margin-right":"5px",display:"inline-flex","align-items":"center"},closable:"",onClose:el=>oe(a,g)},{default:t(()=>[l(s,{style:{"margin-right":"3px"}},{default:t(()=>[g.startsWith("视频")?(i(),x(k(ge),{key:0})):(i(),x(k(B),{key:1}))]),_:2},1024),d(" "+m(g),1)]),_:2},1032,["type","onClose"]))),128))])):(i(),p("div",Ne,[l(u,{type:"primary",onClick:g=>H(a)},{default:t(()=>[l(s,null,{default:t(()=>[l(k(B))]),_:1}),e[22]||(e[22]=d(" 生成资源 "))]),_:2},1032,["onClick"])]))]),_:2},1024)]),_:2},1032,["model"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])]),_:1})):$("",!0),l(M,{class:"box-card"},{header:t(()=>[r("div",je,[r("div",qe,[e[24]||(e[24]=r("span",null,"PPT基本信息",-1)),F.value?(i(),p("span",Me,e[23]||(e[23]=[r("span",{class:"ai-dot"},null,-1),d(" AI自动填充 ")]))):$("",!0)])])]),default:t(()=>[l(J,{model:n.value,rules:Q,ref_key:"formRef",ref:C,"label-width":"120px"},{default:t(()=>[l(b,{label:"PPT主题",prop:"title"},{default:t(()=>[l(T,{modelValue:n.value.title,"onUpdate:modelValue":e[3]||(e[3]=a=>n.value.title=a),placeholder:"请输入PPT主题"},null,8,["modelValue"])]),_:1}),l(b,{label:"章节/用途",prop:"usage"},{default:t(()=>[l(T,{modelValue:n.value.usage,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value.usage=a),placeholder:"如第3章、课程汇报、答辩等"},null,8,["modelValue"])]),_:1}),l(b,{label:"教学大纲",prop:"syllabus"},{default:t(()=>[l(q,{class:"upload-demo","auto-upload":!1,"show-file-list":!0,"on-change":a=>j(a,"syllabus"),accept:".pdf,.doc,.docx"},{default:t(()=>[l(u,{size:"small",type:"primary"},{default:t(()=>e[25]||(e[25]=[d("上传文件")])),_:1})]),_:1},8,["on-change"]),l(T,{modelValue:n.value.syllabusText,"onUpdate:modelValue":e[5]||(e[5]=a=>n.value.syllabusText=a),type:"textarea",rows:3,placeholder:"或直接粘贴教学大纲文本",style:{"margin-top":"8px"}},null,8,["modelValue"])]),_:1}),l(b,{label:"参考教材",prop:"reference"},{default:t(()=>[l(q,{class:"upload-demo","auto-upload":!1,"show-file-list":!0,"on-change":a=>j(a,"reference"),accept:".pdf,.doc,.docx"},{default:t(()=>[l(u,{size:"small",type:"primary"},{default:t(()=>e[26]||(e[26]=[d("上传文件")])),_:1})]),_:1},8,["on-change"]),l(T,{modelValue:n.value.referenceText,"onUpdate:modelValue":e[6]||(e[6]=a=>n.value.referenceText=a),type:"textarea",rows:2,placeholder:"可选，输入参考教材信息",style:{"margin-top":"8px"}},null,8,["modelValue"])]),_:1}),l(b,{label:"备注"},{default:t(()=>[l(T,{modelValue:n.value.remark,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.remark=a),type:"textarea",rows:2,placeholder:"可填写PPT生成的特殊要求、风格等"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1}),r("div",Oe,[l(u,{type:"primary",onClick:ne},{default:t(()=>e[27]||(e[27]=[d("保存")])),_:1}),l(u,{type:"success",onClick:re},{default:t(()=>e[28]||(e[28]=[d("预览")])),_:1}),l(u,{type:"warning",loading:G.value,onClick:ue},{default:t(()=>[d(m(G.value?"导出中...":"导出"),1)]),_:1},8,["loading"]),l(u,{onClick:D},{default:t(()=>e[29]||(e[29]=[d("重置")])),_:1})]),l(K,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=a=>S.value=a),title:"PPT生成预览",width:"60%","destroy-on-close":""},{default:t(()=>[r("div",We,[r("h2",null,m(n.value.title||"PPT预览"),1),l(me,{column:1,border:""},{default:t(()=>[l(U,{label:"PPT主题"},{default:t(()=>[d(m(n.value.title),1)]),_:1}),l(U,{label:"章节/用途"},{default:t(()=>[d(m(n.value.usage),1)]),_:1}),l(U,{label:"教学大纲"},{default:t(()=>[n.value.syllabusFile.length?(i(),p("span",He,"已上传文件")):(i(),p("pre",De,m(n.value.syllabusText),1))]),_:1}),l(U,{label:"参考教材"},{default:t(()=>[n.value.referenceFile.length?(i(),p("span",Je,"已上传文件")):(i(),p("pre",Ke,m(n.value.referenceText),1))]),_:1}),l(U,{label:"备注"},{default:t(()=>[d(m(n.value.remark),1)]),_:1})]),_:1}),r("div",Qe,[e[30]||(e[30]=r("h3",null,"章节内容",-1)),(i(!0),p(z,null,A(h.value,(a,P)=>(i(),p("div",{key:P,class:"chapter-preview-item"},[r("h4",null,"第"+m(P+1)+"章："+m(a.title),1),r("p",null,m(a.content),1),a.graphic?(i(),p("img",{key:0,src:a.graphic,alt:"资源",class:"chapter-graphic"},null,8,Xe)):$("",!0)]))),128))])])]),_:1},8,["modelValue"]),l(K,{modelValue:V.value,"onUpdate:modelValue":e[10]||(e[10]=a=>V.value=a),title:"资源生成",width:"70%","destroy-on-close":""},{default:t(()=>[V.value?(i(),x(be,{key:0,chapter:R.value,mode:"dialog",onGenerate:se,onCancel:e[9]||(e[9]=a=>V.value=!1)},null,8,["chapter"])):$("",!0)]),_:1},8,["modelValue"])])}}});const ol=Te(Ye,[["__scopeId","data-v-609b2844"]]);export{ol as default};
