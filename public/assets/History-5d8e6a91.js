import{a as U}from"./axios-3a665b0f.js";import{k as $,r as h,p as j,$ as z,b as a,ak as H,o as y,c as v,d as g,f as s,w as r,h as d,g as P,t as w,s as T,T as M,q as S,E as l}from"./index-8f7409db.js";import{_ as q}from"./_plugin-vue_export-helper-c27b6911.js";const K=()=>{const t=window.location.hostname;return t==="localhost"||t==="127.0.0.1"?"http://localhost:8081/api":"/api"},R=K(),p=U.create({baseURL:R,headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:1e4});p.interceptors.request.use(t=>t,t=>Promise.reject(t));p.interceptors.response.use(t=>t,t=>(console.error("API请求失败:",t),Promise.reject(t)));const b={getRecords(){return p.get("/history/records")},deleteRecord(t){return p.delete(`/history/records/${t}`)},exportRecord(t){return p.get(`/history/records/${t}/export`,{responseType:"blob"})}},F=()=>[{id:1,content:"教学大纲：Python基础课程",type:"大纲设计",time:"2023-09-15T14:30:00"},{id:2,content:"Python面向对象编程PPT",type:"PPT",time:"2023-09-16T10:15:00"},{id:3,content:"数据结构与算法互动习题",type:"互动环节",time:"2023-09-17T16:45:00"}],x=R,G={class:"history-container"},J={class:"top-bar"},O={key:0,class:"api-info"},Q={class:"content-cell"},W={key:0,class:"empty-state"},X=$({__name:"History",setup(t){const u=h(""),i=h([]),c=h(!1),C=j(()=>{let o=i.value;if(u.value){const e=u.value.toLowerCase();o=o.filter(_=>_.content.toLowerCase().includes(e)||_.type.toLowerCase().includes(e))}return o}),A=o=>new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),k=async()=>{c.value=!0;try{const o=await b.getRecords();i.value=o.data,l.success("数据加载成功")}catch(o){console.error("获取历史记录失败:",o),l.error("获取历史记录失败"),i.value=F()}finally{c.value=!1}},L=async o=>{try{await b.exportRecord(o.id),l.success("导出成功")}catch(e){console.error("导出失败:",e),l.success("导出功能模拟成功")}},B=async o=>{try{await b.deleteRecord(o.id),i.value=i.value.filter(e=>e.id!==o.id),l.success("删除成功")}catch(e){console.error("删除失败:",e),l.error("删除失败")}};return z(()=>{console.log("使用API基础路径:",x),k()}),(o,e)=>{const _=a("el-input"),f=a("el-button"),V=a("el-tag"),m=a("el-table-column"),D=a("el-table"),E=a("el-empty"),I=H("loading");return y(),v("div",G,[e[4]||(e[4]=g("h2",null,"输出历史",-1)),g("div",J,[s(_,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=n=>u.value=n),placeholder:"搜索内容/工具",style:{width:"220px"},clearable:""},null,8,["modelValue"]),s(f,{type:"primary",onClick:k,loading:c.value},{default:r(()=>e[1]||(e[1]=[d("刷新")])),_:1},8,["loading"]),P(x)?(y(),v("div",O,[s(V,{size:"small"},{default:r(()=>[d("API: "+w(P(x)),1)]),_:1})])):T("",!0)]),M((y(),S(D,{data:C.value,border:"",style:{width:"100%","margin-top":"18px"},"element-loading-text":"加载中..."},{default:r(()=>[s(m,{prop:"content",label:"内容摘要","min-width":"260"},{default:r(n=>[g("div",Q,w(n.row.content),1)]),_:1}),s(m,{prop:"type",label:"工具类型",width:"110"}),s(m,{prop:"time",label:"生成时间",width:"170"},{default:r(n=>[d(w(A(n.row.time)),1)]),_:1}),s(m,{label:"操作",width:"140",fixed:"right"},{default:r(n=>[s(f,{size:"small",type:"success",onClick:N=>L(n.row)},{default:r(()=>e[2]||(e[2]=[d("导出")])),_:2},1032,["onClick"]),s(f,{size:"small",type:"danger",onClick:N=>B(n.row)},{default:r(()=>e[3]||(e[3]=[d("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[I,c.value]]),C.value.length===0&&!c.value?(y(),v("div",W,[s(E,{description:"暂无历史记录"})])):T("",!0)])}}});const te=q(X,[["__scopeId","data-v-7faf1cea"]]);export{te as default};
